взяти визначення ./Памʼять;
взяти визначення ./Кодування;

місцева дія __біб__вивести_ю8(значення: ю8);
місцева дія __біб__вивести_байти(розмір: природне, дані: памʼять<п8>);
місцева дія __біб__надрукувати_ю8(значення: ю8);
місцева дія __біб__вивести_природне(значення: природне);
місцева дія __біб__надрукувати_природне(значення: природне);

місцева дія __біб__перетворити_природне_на_ю8(значення: природне, вихід: адреса<ю8>);

простір біб {
  дія вивести_символ(значення: п32) {
    змінна символ = п8(значення);
    змінна значення_ю8 = ю8 { 0, пусто };
    змінна позиція_помилки: природне = 0;
    перекодувати_т8_в_ю8(т8 { 1, символ::адреса як памʼять<п8> }, ні, значення_ю8::адреса, пусто, позиція_помилки::адреса);
    __біб__вивести_ю8(значення_ю8);
    звільнити_памʼять(значення_ю8.дані);
  }

  дія вивести(значення: т8) {
    змінна значення_ю8 = ю8 { 0, пусто };
    змінна позиція_помилки: природне = 0;
    перекодувати_т8_в_ю8(значення, ні, значення_ю8::адреса, пусто, позиція_помилки::адреса);
    __біб__вивести_ю8(значення_ю8);
    звільнити_памʼять(значення_ю8.дані);
  }

  дія надрукувати(значення: т8) {
    змінна значення_ю8 = ю8 { 0, пусто };
    змінна позиція_помилки: природне = 0;
    перекодувати_т8_в_ю8(значення, ні, значення_ю8::адреса, пусто, позиція_помилки::адреса);
    __біб__надрукувати_ю8(значення_ю8);
    звільнити_памʼять(значення_ю8.дані);
  }

  дія вивести_символ_юнікоду(значення: п32) {
    змінна розмір: природне = 0;
    змінна дані = виділити_памʼять<п8>(4);

    якщо значення <= 127 {
      розмір = 1;
      дані[0] = п8(значення);
    } інакше якщо значення <= 2047 {
      розмір = 2;
      дані[0] = п8(п32(192) ∨ (значення >> 6));
      дані[1] = п8(п32(128) ∨ (значення ∧ 63));
    } інакше якщо значення <= 65535 {
      розмір = 3;
      дані[0] = п8(п32(224) ∨ (значення >> 12));
      дані[1] = п8(п32(128) ∨ ((значення >> 6) ∧ 63));
      дані[2] = п8(п32(128) ∨ (значення ∧ 63));
    } інакше якщо значення <= 1114111 {
      розмір = 4;
      дані[0] = п8(п32(240) ∨ (значення >> 18));
      дані[1] = п8(п32(128) ∨ ((значення >> 12) ∧ 63));
      дані[2] = п8(п32(128) ∨ ((значення >> 6) ∧ 63));
      дані[3] = п8(п32(128) ∨ (значення ∧ 63));
    } інакше {
      вернути;
    }

    змінна значення_ю8 = ю8 { розмір, дані };

    __біб__вивести_ю8(значення_ю8);

    звільнити_памʼять(дані);
  }

  дія вивести_ю8(значення: ю8) {
    __біб__вивести_ю8(значення);
  }

  дія вивести_байти(розмір: природне, дані: памʼять<п8>) {
    __біб__вивести_байти(розмір, дані);
  }

  дія надрукувати_ю8(значення: ю8) {
    __біб__надрукувати_ю8(значення);
  }

  дія перетворити_природне_на_ю8(значення: природне) -> ю8 {
    змінна результат = ю8 { 0, пусто };
    __біб__перетворити_природне_на_ю8(значення, результат::адреса);
    вернути результат;
  }

  дія вивести_природне(значення: природне) {
    __біб__вивести_природне(значення);
  }

  дія надрукувати_природне(значення: природне) {
    __біб__надрукувати_природне(значення);
  }
}