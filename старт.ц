взяти означення ./мавка;

зовнішня дія __надрукувати_ю8(значення: адреса<ю8>) -> ніщо;
зовнішня дія __надрукувати_д64(значення: д64) -> ніщо;
зовнішня дія __виділити_сиру_памʼять(розмір: природне) -> памʼять<п8>;
зовнішня дія __перевиділити_сиру_памʼять(значення: памʼять<п8>, новий_розмір: природне) -> памʼять<п8>;
зовнішня дія __звільнити_сиру_памʼять(значення: памʼять<п8>) -> ніщо;
зовнішня дія __вийти(код: ц32) -> ніщо;

дія надрукувати_ю8(значення: ю8) -> ніщо {
  __надрукувати_ю8(значення::адреса);
}

дія надрукувати_д64(значення: д64) -> ніщо {
  __надрукувати_д64(значення);
}

дія виділити_сиру_памʼять(М: адреса<мавка::Машина>, розмір: природне) -> памʼять<п8> {
  вернути __виділити_сиру_памʼять(розмір);
}

дія перевиділити_сиру_памʼять(М: адреса<мавка::Машина>, значення: памʼять<п8>, новий_розмір: природне) -> памʼять<п8> {
  вернути __перевиділити_сиру_памʼять(значення, новий_розмір);
}

дія звільнити_сиру_памʼять(М: адреса<мавка::Машина>, значення: памʼять<п8>) -> ніщо {
  __звільнити_сиру_памʼять(значення);
}

дія запанікувати(М: адреса<мавка::Машина>, повідомлення: кд) {
  надрукувати_ю8(ю8"Айайайай!!!");

  __вийти(1);
}

дія надрукувати_значення(М: адреса<мавка::Машина>, значення: адреса<мавка::Дійсне>) {
  якщо значення.тип == М.значення_структура_Число {
    змінна предмет_числа = значення як адреса<мавка::Предмет>;
    змінна властивості_числа = предмет_числа.властивості як мавка::ВластивостіЧисла;

    надрукувати_д64(властивості_числа.значення);
  } інакше {
    надрукувати_ю8(ю8"невідомо");
  }
}

дія рідна_дія_друк(М: адреса<мавка::Машина>,
                   здійснювач: адреса<мавка::Дійсне>,
                   значення: адреса<мавка::Дійсне>,
                   кількість_задіяних: природне, 
                   задіяні: памʼять<адреса<мавка::Дійсне>>,
                   кількість_іменовано_задіяних: природне, 
                   іменовано_задіяні: памʼять<адреса<мавка::Дійсне>>) -> адреса<мавка::Дійсне> {
  надрукувати_ю8(ю8"привіт");
  вернути пусто;                  
}

зовнішня дія старт() -> ц32 {
  змінна сирий_текст = "2 + 2";

  змінна М = виділити_сиру_памʼять(пусто, мавка::Машина.розмір) як адреса<мавка::Машина>;
  
  мавка::налаштувати_машину(М, мавка::Налаштування {
    виділити_сиру_памʼять = виділити_сиру_памʼять,
    перевиділити_сиру_памʼять = перевиділити_сиру_памʼять,
    звільнити_сиру_памʼять = звільнити_сиру_памʼять,
    запанікувати = запанікувати
  });

  змінна а = мавка::створити_число(М, 2);
  змінна б = мавка::створити_число(М, 2);

  змінна в = мавка::виконати_додавання(М, а, б);
  
  надрукувати_значення(М, в);
  
  змінна дія_друк = мавка::створити_рідну_дію(
    М,
    мавка::створити_текст(М, "друк"),
    пусто,
    рідна_дія_друк
  );
  
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);
  мавка::покласти_в_накопичувач_значень(М, пусто);

  надрукувати_д64(д64(М.накопичувач_значень.розмір));

  змінна результат = мавка::здійснити(
    М,
    пусто,
    дія_друк,
    0,
    пусто,
    0,
    пусто
  );

  змінна розмір_вказівок: природне = 2;
  змінна дані_вказівок = мавка::виділити_памʼять<п8>(М, розмір_вказівок);
  дані_вказівок[0] = мавка::ВДодати;
  дані_вказівок[1] = мавка::ВВернути;

  змінна вказівки = мавка::створити_дані(
    М,
    розмір_вказівок,
    дані_вказівок
  );

  мавка::звільнити_памʼять(М, дані_вказівок);

  змінна код = мавка::створити_код(
    М,
    пусто,
    вказівки
  );

  змінна дія_сума = мавка::створити_дію(
    М,
    пусто,
    мавка::створити_текст(М, "сума"),
    пусто,
    код
  );
  
  мавка::покласти_в_накопичувач_значень(М, мавка::створити_число(М, 12));
  мавка::покласти_в_накопичувач_значень(М, мавка::створити_число(М, 23));

  результат = мавка::здійснити(
    М,
    пусто,
    дія_сума,
    0,
    пусто,
    0,
    пусто
  );

  надрукувати_значення(М, результат);

  вернути 0;
}