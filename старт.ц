взяти визначення мавка;
взяти визначення мавка/бібліотека;
взяти визначення турбо;

дія відклик_після_події_турбо_рушія(рушій: адреса<ТурбоРушій>, аргумент_відклику: невідома_адреса): ніщо {
  ціль обчислювач = аргумент_відклику як адреса<мавка::Обчислювач>;

  ціль результат_обробки = мавка::обробити_чергу_запланованих_виконань(обчислювач);
  якщо мавка::перевірити_чи_стан_падіння(обчислювач) {
    ціль інформація_падіння = мавка::отримати_інформацію_падіння(обчислювач);
    мавка::надрукувати_падіння(обчислювач, інформація_падіння, результат_обробки);
    мавка::знищити_інформацію_падіння(обчислювач, інформація_падіння);
  }
}

зовнішня дія запустити_мавку(кількість_аргументів: ц32, аргументи: памʼять<ю8>): ц32 {
  ціль рушій = турбо_глобальний_рушій();

  ціль обчислювач = мавка::створити_обчислювач();

  ціль результат_визначення_глобальних = мавка::визначити_глобальні(обчислювач);
  якщо мавка::перевірити_чи_стан_падіння(обчислювач) {
    ціль інформація_падіння = мавка::отримати_інформацію_падіння(обчислювач);
    мавка::надрукувати_падіння(обчислювач, інформація_падіння, результат_визначення_глобальних);
    мавка::знищити_інформацію_падіння(обчислювач, інформація_падіння);
    турбо_знищити_рушій(рушій);
    мавка::знищити_обчислювач(обчислювач);
    вернути 1;
  }

  мавка::встановити_обробник_взяття_біб(обчислювач, мавка::бібліотека::обробник_взяття_біб);

  якщо кількість_аргументів == 1 {
    мавка::вивести_ю8(обчислювач, ю8"Діалог Мавки ");
    мавка::надрукувати_т8(обчислювач, мавка::отримати_версію_мавки_як_т8());
    мавка::почати_діалог(обчислювач);
    турбо_знищити_рушій(рушій);
    мавка::знищити_обчислювач(обчислювач);
    вернути 0;
  }

  ціль результат_взяття = мавка::взяти_файл_шлях_ю8(обчислювач, аргументи[1]);
  якщо мавка::перевірити_чи_стан_падіння(обчислювач) {
    ціль інформація_падіння = мавка::отримати_інформацію_падіння(обчислювач);
    мавка::надрукувати_падіння(обчислювач, інформація_падіння, результат_взяття);
    мавка::знищити_інформацію_падіння(обчислювач, інформація_падіння);
    турбо_знищити_рушій(рушій);
    мавка::знищити_обчислювач(обчислювач);
    вернути 1;
  }

  ціль результат_обробки = мавка::обробити_чергу_запланованих_виконань(обчислювач);
  якщо мавка::перевірити_чи_стан_падіння(обчислювач) {
    ціль інформація_падіння = мавка::отримати_інформацію_падіння(обчислювач);
    мавка::надрукувати_падіння(обчислювач, інформація_падіння, результат_обробки);
    мавка::знищити_інформацію_падіння(обчислювач, інформація_падіння);
    турбо_знищити_рушій(рушій);
    мавка::знищити_обчислювач(обчислювач);
    вернути 1;
  }

  змінна турбо_результат = ні;
  змінна турбо_помилка = ТурбоПомилка { ... };

  турбо_результат = турбо_запустити_рушій(рушій, відклик_після_події_турбо_рушія, обчислювач, турбо_помилка::адреса);
  якщо турбо_результат == ні {
    // ...
  }

  турбо_знищити_рушій(рушій);

  мавка::знищити_обчислювач(обчислювач);

  вернути 0;
}