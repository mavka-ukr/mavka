взяти визначення ./Виділяч;
взяти визначення ./Кодування;

місцева дія __біб__вивести_ю8(значення: ю8);
місцева дія __біб__вивести_байти(розмір: натуральне, дані: памʼять<н8>);
місцева дія __біб__надрукувати_ю8(значення: ю8);
місцева дія __біб__вивести_позитивне(значення: позитивне);
місцева дія __біб__надрукувати_позитивне(значення: позитивне);

місцева дія __біб__перетворити_позитивне_на_ю8(виділяч: адреса<біб::Виділяч>, значення: позитивне, вихід: адреса<ю8>);

секція біб {
  дія вивести_символ(значення: п32) {
    змінна символ = п8(значення);
    змінна виділяч = отримати_системний_виділяч();
    змінна значення_ю8 = ю8 { 0, пусто };
    змінна позиція_помилки: позитивне = 0;
    перекодувати_т8_в_ю8(виділяч, т8 { 1, символ::адреса як памʼять<п8> }, ні, значення_ю8::адреса, пусто, позиція_помилки::адреса);
    __біб__вивести_ю8(значення_ю8);
    звільнити_памʼять(виділяч, значення_ю8.дані);
  }

  дія вивести(значення: т8) {
    змінна виділяч = отримати_системний_виділяч();
    змінна значення_ю8 = ю8 { 0, пусто };
    змінна позиція_помилки: позитивне = 0;
    перекодувати_т8_в_ю8(виділяч, значення, ні, значення_ю8::адреса, пусто, позиція_помилки::адреса);
    __біб__вивести_ю8(значення_ю8);
    звільнити_памʼять(виділяч, значення_ю8.дані);
  }

  дія надрукувати(значення: т8) {
    змінна виділяч = отримати_системний_виділяч();
    змінна значення_ю8 = ю8 { 0, пусто };
    змінна позиція_помилки: позитивне = 0;
    перекодувати_т8_в_ю8(виділяч, значення, ні, значення_ю8::адреса, пусто, позиція_помилки::адреса);
    __біб__надрукувати_ю8(значення_ю8);
    звільнити_памʼять(виділяч, значення_ю8.дані);
  }

  дія вивести_символ_юнікоду(значення: п32) {
    змінна виділяч = отримати_системний_виділяч();

    змінна розмір: позитивне = 0;
    змінна дані = виділити_памʼять<п8>(виділяч, 4);

    якщо (значення <= 127) {
      розмір = 1;
      дані[0] = п8(значення);
    } інакше якщо (значення <= 2047) {
      розмір = 2;
      дані[0] = п8(п32(192) | (значення >> 6));
      дані[1] = п8(п32(128) | (значення & 63));
    } інакше якщо (значення <= 65535) {
      розмір = 3;
      дані[0] = п8(п32(224) | (значення >> 12));
      дані[1] = п8(п32(128) | ((значення >> 6) & 63));
      дані[2] = п8(п32(128) | (значення & 63));
    } інакше якщо (значення <= 1114111) {
      розмір = 4;
      дані[0] = п8(п32(240) | (значення >> 18));
      дані[1] = п8(п32(128) | ((значення >> 12) & 63));
      дані[2] = п8(п32(128) | ((значення >> 6) & 63));
      дані[3] = п8(п32(128) | (значення & 63));
    } інакше {
      вернути;
    }

    змінна значення_ю8 = ю8 { розмір, дані };

    __біб__вивести_ю8(значення_ю8);

    звільнити_памʼять(виділяч, дані);
  }

  дія вивести_ю8(значення: ю8) {
    __біб__вивести_ю8(значення);
  }

  дія вивести_байти(розмір: натуральне, дані: памʼять<н8>) {
    __біб__вивести_байти(розмір, дані);
  }

  дія надрукувати_ю8(значення: ю8) {
    __біб__надрукувати_ю8(значення);
  }

  дія перетворити_позитивне_на_ю8(виділяч: адреса<Виділяч>, значення: позитивне): ю8 {
    змінна результат = ю8 { 0, пусто };
    __біб__перетворити_позитивне_на_ю8(виділяч, значення, результат::адреса);
    вернути результат;
  }

  дія вивести_позитивне(значення: позитивне) {
    __біб__вивести_позитивне(значення);
  }

  дія надрукувати_позитивне(значення: позитивне) {
    __біб__надрукувати_позитивне(значення);
  }
}