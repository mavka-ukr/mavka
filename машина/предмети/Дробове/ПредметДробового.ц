взяти означення мавка/машина;

простір мавка {
  місцева дія записати_метод_структури_Дробове__чародія_ціле(М: адреса<Машина>);
  місцева дія записати_метод_структури_Дробове__чародія_дробове(М: адреса<Машина>);
  місцева дія записати_метод_структури_Дробове__чародія_текст(М: адреса<Машина>);

  дія рідна_дія__з(
    М: адреса<Машина>,
    здійснювач: адреса<Предмет>,
    предмет_дії: адреса<ПредметДії>,
    задіяні: Задіяні
  ) -> ПредметАбоСтанПадіння {
    змінна задіяне_значення: адреса<Предмет> = пусто;

    знайти_задіяне(М, задіяні, 0, М.константи_назв._значення, задіяне_значення::адреса);

    якщо задіяне_значення == пусто {
      вернути створити_дробове_з_д64(М, 0.0) як адреса<Предмет>;
    }

    якщо задіяне_значення == М.значення_дійсне {
      вернути створити_дробове_з_д64(М, 1.0) як адреса<Предмет>;
    }

    вернути здійснити_властивість(
      М,
      задіяне_значення,
      М.константи_назв._чародія_дробове,
      Задіяні { 0, пусто, пусто },
      Місцезнаходження { пусто, 0 }
    );
  }

  дія записати_дію__з(М: адреса<Машина>) {
    змінна предмет_дії = створити_рідну_дію(
      М,
      М.константи_назв._з,
      М.предмет_пустої_послідовності як адреса<ПредметПослідовності>,
      пусто,
      рідна_дія__з,
      пусто
    );

    предмет_структури_змінити_властивість(
      М,
      М.предмет_структури_Дробове,
      М.константи_назв._з,
      предмет_дії як адреса<Предмет>,
      Місцезнаходження { пусто, 0 }
    );

    якщо М.стан_падіння {
      запанікувати(М, "Помилка при записі дії \"з\" для структури \"Дробове\".");
    }
  }
}

простір мавка {
  місцева дія заповнити_структуру_Дробове(
    М: адреса<Машина>
  ) {
    М.предмет_структури_Дробове.заборонити_наслідування = так;

    записати_метод_структури_Дробове__чародія_ціле(М);
    записати_метод_структури_Дробове__чародія_дробове(М);
    записати_метод_структури_Дробове__чародія_текст(М);

    записати_дію__з(М);
  }

  місцева дія створити_дробове(
    М: адреса<Машина>,
    значення: ДЧ::Дробове
  ) -> адреса<ПредметДробового> {
    змінна предмет = виділити_предмет<ПредметДробового>(М, М.предмет_структури_Дробове);

    якщо не ДЧ::клонувати_дробове(М.виділяч_ДЧ, значення, предмет.значення::адреса) {
      запанікувати(М, "Не вдалося створити дробове число.");
    }

    вернути предмет;
  }

  місцева дія створити_дробове_без_копіювання(
    М: адреса<Машина>,
    значення: ДЧ::Дробове
  ) -> адреса<ПредметДробового> {
    змінна предмет = виділити_предмет<ПредметДробового>(М, М.предмет_структури_Дробове);

    предмет.значення = значення;

    вернути предмет;
  }

  місцева дія створити_дробове_з_д64(
    М: адреса<Машина>,
    значення: д64
  ) -> адреса<ПредметДробового> {
    змінна предмет = виділити_предмет<ПредметДробового>(М, М.предмет_структури_Дробове);

    якщо не ДЧ::ініціалізувати_дробове_з_д64(М.виділяч_ДЧ, значення, предмет.значення::адреса) {
      запанікувати(М, "Не вдалося створити дробове число з д64.");
    }

    вернути предмет;
  }

  місцева дія предмет_дробового_додати(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::додати_дробове_і_ціле(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось додати дробове і ціле!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_ціле = право як адреса<ПредметДробового>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::додати_дробові(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось додати дробові!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Додати до дробового числа можна лише або ціле або дробове число.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_відняти(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::відняти_дробове_і_ціле(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось відняти дробове і ціле!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_ціле = право як адреса<ПредметДробового>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::відняти_дробові(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось відняти дробові!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Відняти від дробового числа можна лише або ціле або дробове число.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_помножити(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::помножити_дробове_і_ціле(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось помножити дробове і ціле!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_ціле = право як адреса<ПредметДробового>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::помножити_дробові(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось помножити дробові!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Помножити дробове число можна лише на або ціле або дробове число.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_поділити(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::поділити_дробове_і_ціле(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось поділити дробове і ціле!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_ціле = право як адреса<ПредметДробового>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::поділити_дробові(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось поділити дробові!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Поділити дробове число можна лише на або ціле або дробове число.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_остача(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::залишок_ділення_дробового_і_цілого(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось отримати остачу дробове і ціле!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_ціле = право як адреса<ПредметДробового>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::залишок_ділення_дробових(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось отримати остачу дробові!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Отримати остачу ділення дробового числа можна лише з або цілим або дробовим число.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_степінь(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::степінь_дробового_і_цілого(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось піднести дробове до степеня цілого!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_ціле = право як адреса<ПредметДробового>;

      змінна нове_значення: ДЧ::Дробове;

      якщо не ДЧ::степінь_дробового(М.виділяч_ДЧ, значення.значення, право_ціле.значення, М.точність_дробового, нове_значення::адреса) {
        увімкнути_стан_падіння(
          М,
          створити_текст(М, "[ПОМИЛКА МАШИНИ] Не вдалось піднести дробове до степеня дробового!") як адреса<Предмет>,
          місцезнаходження
        );
        вернути пусто;
      }

      вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Отримати степінь дробового числа можна лише з або цілим або дробовим число.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_менше(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      якщо ДЧ::порівняти_дробове_і_ціле(М.виділяч_ДЧ, значення.значення, право_ціле.значення) < 0 {
        вернути М.значення_дійсне як адреса<Предмет>;
      } інакше {
        вернути пусто;
      }
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_дробове = право як адреса<ПредметДробового>;

      якщо ДЧ::порівняти_дробові(М.виділяч_ДЧ, значення.значення, право_дробове.значення) < 0 {
        вернути М.значення_дійсне як адреса<Предмет>;
      } інакше {
        вернути пусто;
      }
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Виконути перевірку чи дробове число менше можна з цілим або дробовим числом.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_більше(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    право: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо право.тип == М.предмет_структури_Ціле {
      змінна право_ціле = право як адреса<ПредметЦілого>;

      якщо ДЧ::порівняти_дробове_і_ціле(М.виділяч_ДЧ, значення.значення, право_ціле.значення) > 0 {
        вернути М.значення_дійсне як адреса<Предмет>;
      } інакше {
        вернути пусто;
      }
    }

    якщо право.тип == М.предмет_структури_Дробове {
      змінна право_дробове = право як адреса<ПредметДробового>;

      якщо ДЧ::порівняти_дробові(М.виділяч_ДЧ, значення.значення, право_дробове.значення) > 0 {
        вернути М.значення_дійсне як адреса<Предмет>;
      } інакше {
        вернути пусто;
      }
    }

    увімкнути_стан_падіння(
      М,
      створити_текст(М, "Виконути перевірку чи дробове число менше можна з цілим або дробовим числом.") як адреса<Предмет>,
      місцезнаходження
    );
    вернути пусто;
  }

  місцева дія предмет_дробового_змінити_знак(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    змінна нове_значення: ДЧ::Дробове;

    якщо не ДЧ::мінус_дробове(М.виділяч_ДЧ, значення.значення, нове_значення::адреса) {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Не вдалось змінити знак дробового числа.") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    вернути створити_дробове_без_копіювання(М, нове_значення) як адреса<Предмет>;
  }

  місцева дія предмет_дробового_отримати_властивість(
    М: адреса<Машина>,
    значення: адреса<ПредметДробового>,
    назва: адреса<ПредметТексту>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    змінна предмет_методу = знайти_метод_в_структурі(
      М,
      М.предмет_структури_Дробове,
      назва
    );

    якщо предмет_методу == пусто {
      вернути пусто;
    }

    вернути предмет_методу як адреса<Предмет>;
  }
}