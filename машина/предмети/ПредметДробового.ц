взяти означення мавка/машина;

простір мавка {
  дія рідна_дія_методу_структури_Дробове__чародія_ціле(
    М: адреса<Машина>,
    здійснювач: Значення,
    предмет_дії: адреса<ПредметДії>,
    задіяні: Задіяні
  ) -> ЗначенняАбоСтанПадіння {
    якщо здійснювач.вид != ЗДробове {
      увімкнути_стан_падіння(
        М,
        значення_предмет(створити_текст(М, "Неможливо здійснити дію дробового \"чародія_ціле\".")),
        Місцезнаходження { пусто, 0 }
      );
      вернути значення_недійсне();
    }

    вернути значення_ціле(ц64(здійснювач.дані як д64));
  }

  дія записати_метод_структури_Дробове__чародія_ціле(
    М: адреса<Машина>
  ) {
    змінна предмет_дії = створити_рідну_дію(
      М,
      М.константи_назв._чародія_ціле,
      М.предмет_пустої_послідовності,
      пусто,
      рідна_дія_методу_структури_Дробове__чародія_ціле,
      пусто
    );

    записати_метод_структури(
      М,
      М.предмет_структури_Дробове,
      М.константи_назв._чародія_ціле,
      предмет_дії
    );

    якщо М.стан_падіння {
      запанікувати(М, "Помилка при записі дії \"чародія_ціле\" для структури \"Дробове\".");
    }
  }
}

простір мавка {
  дія рідна_дія_методу_структури_Дробове__чародія_дробове(
    М: адреса<Машина>,
    здійснювач: Значення,
    предмет_дії: адреса<ПредметДії>,
    задіяні: Задіяні
  ) -> ЗначенняАбоСтанПадіння {
    якщо здійснювач.вид != ЗДробове {
      увімкнути_стан_падіння(
        М,
        значення_предмет(створити_текст(М, "Неможливо здійснити дію дробового \"чародія_дробове\".")),
        Місцезнаходження { пусто, 0 }
      );
      вернути значення_недійсне();
    }

    вернути здійснювач;
  }

  дія записати_метод_структури_Дробове__чародія_дробове(
    М: адреса<Машина>
  ) {
    змінна предмет_дії = створити_рідну_дію(
      М,
      М.константи_назв._чародія_дробове,
      М.предмет_пустої_послідовності,
      пусто,
      рідна_дія_методу_структури_Дробове__чародія_дробове,
      пусто
    );

    записати_метод_структури(
      М,
      М.предмет_структури_Дробове,
      М.константи_назв._чародія_дробове,
      предмет_дії
    );

    якщо М.стан_падіння {
      запанікувати(М, "Помилка при записі дії \"чародія_дробове\" для структури \"Дробове\".");
    }
  }
}

простір мавка {
  дія рідна_дія_методу_структури_Дробове__чародія_текст(
    М: адреса<Машина>,
    здійснювач: Значення,
    предмет_дії: адреса<ПредметДії>,
    задіяні: Задіяні
  ) -> ЗначенняАбоСтанПадіння {
    якщо здійснювач.вид != ЗДробове {
      увімкнути_стан_падіння(
        М,
        значення_предмет(створити_текст(М, "Неможливо здійснити дію дробового \"чародія_текст\".")),
        Місцезнаходження { пусто, 0 }
      );
      вернути значення_недійсне();
    }

    змінна значення = здійснювач.дані як ц64;

    вернути значення_предмет(створити_текст(М, "<Дробове>"));
  }

  дія записати_метод_структури_Дробове__чародія_текст(
    М: адреса<Машина>
  ) {
    змінна предмет_дії = створити_рідну_дію(
      М,
      М.константи_назв._чародія_текст,
      М.предмет_пустої_послідовності,
      пусто,
      рідна_дія_методу_структури_Дробове__чародія_текст,
      пусто
    );

    записати_метод_структури(
      М,
      М.предмет_структури_Дробове,
      М.константи_назв._чародія_текст,
      предмет_дії
    );

    якщо М.стан_падіння {
      запанікувати(М, "Помилка при записі дії \"чародія_текст\" для структури \"Дробове\".");
    }
  }
}

простір мавка {
  дія рідна_дія__з(
    М: адреса<Машина>,
    здійснювач: Значення,
    предмет_дії: адреса<ПредметДії>,
    задіяні: Задіяні
  ) -> ЗначенняАбоСтанПадіння {
    змінна задіяне_значення: Значення = значення_недійсне();

    знайти_задіяне(М, задіяні, 0, М.константи_назв._значення, задіяне_значення::адреса);

    якщо задіяне_значення.вид == ЗНедійсне {
      вернути значення_дробове(0.0);
    }

    якщо задіяне_значення.вид == ЗДійсне {
      вернути значення_дробове(1.0);
    }

    якщо задіяне_значення.вид == ЗЦіле {
      вернути значення_дробове(д64(задіяне_значення.дані як ц64));
    }

    якщо задіяне_значення.вид == ЗДробове {
      вернути задіяне_значення;
    }

    вернути здійснити_властивість(
      М,
      задіяне_значення,
      М.константи_назв._чародія_дробове,
      Задіяні { 0, пусто, пусто },
      Місцезнаходження { пусто, 0 }
    );
  }

  дія записати_дію__з(М: адреса<Машина>) {
    змінна предмет_дії = створити_рідну_дію(
      М,
      М.константи_назв._з,
      М.предмет_пустої_послідовності як адреса<ПредметПослідовності>,
      пусто,
      рідна_дія__з,
      пусто
    );

    предмет_структури_змінити_властивість(
      М,
      М.предмет_структури_Дробове,
      М.константи_назв._з,
      значення_предмет(предмет_дії),
      Місцезнаходження { пусто, 0 }
    );

    якщо М.стан_падіння {
      запанікувати(М, "Помилка при записі дії \"з\" для структури \"Дробове\".");
    }
  }
}

простір мавка {
  місцева дія заповнити_структуру_Дробове(
    М: адреса<Машина>
  ) {
    М.предмет_структури_Дробове.заборонити_наслідування = так;

    записати_метод_структури_Дробове__чародія_ціле(М);
    записати_метод_структури_Дробове__чародія_дробове(М);
    записати_метод_структури_Дробове__чародія_текст(М);

    записати_дію__з(М);
  }

  місцева дія предмет_дробового_додати(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(значення + д64(право.дані як д64));
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(значення + право.дані як д64);
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Додати до дробового числа можна лише або ціле або дробове число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_відняти(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(значення - д64(право.дані як ц64));
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(значення - право.дані як д64) як Значення;
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Відняти від дробового числа можна лише або ціле або дробове число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_помножити(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(значення * д64(право.дані як ц64));
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(значення * право.дані як д64) як Значення;
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Помножити дробове число можна лише на або ціле або дробове число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_поділити(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(значення / д64(право.дані як ц64)) як Значення;
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(значення / право.дані як д64) як Значення;
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Поділити дробове число можна лише на або ціле або дробове число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_остача(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(значення % д64(право.дані як ц64));
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(значення % право.дані як д64) як Значення;
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Отримати остачу ділення дробового числа можна лише з або цілим або дробовим число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_поділити_націло(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(значення / д64(право.дані як ц64));
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(значення / право.дані як д64);
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Отримати неповну частку ділення дробового числа можна лише з або цілим або дробовим число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_степінь(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      вернути значення_дробове(піднести_до_степеня_д64(М, значення, д64(право.дані як ц64)));
    }

    якщо право.вид == ЗДробове {
      вернути значення_дробове(піднести_до_степеня_д64(М, значення, право.дані як д64));
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Отримати степінь дробового числа можна лише з або цілим або дробовим число.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_менше(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      якщо значення < д64(право.дані як ц64) {
        вернути значення_дійсне();
      } інакше {
        вернути значення_недійсне();
      }
    }

    якщо право.вид == ЗДробове {
      якщо значення < право.дані як д64 {
        вернути значення_дійсне();
      } інакше {
        вернути значення_недійсне();
      }
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Виконути перевірку чи дробове число менше можна з цілим або дробовим числом.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_більше(
    М: адреса<Машина>,
    значення: д64,
    право: Значення,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    якщо право.вид == ЗЦіле {
      якщо значення > д64(право.дані як ц64) {
        вернути значення_дійсне();
      } інакше {
        вернути значення_недійсне();
      }
    }

    якщо право.вид == ЗДробове {
      якщо значення > право.дані як д64 {
        вернути значення_дійсне();
      } інакше {
        вернути значення_недійсне();
      }
    }

    увімкнути_стан_падіння(
      М,
      значення_предмет(створити_текст(М, "Виконути перевірку чи дробове число менше можна з цілим або дробовим числом.")),
      місцезнаходження
    );
    вернути значення_недійсне();
  }

  місцева дія предмет_дробового_змінити_знак(
    М: адреса<Машина>,
    значення: д64,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    вернути значення_дробове(-значення);
  }

  місцева дія предмет_дробового_отримати_властивість(
    М: адреса<Машина>,
    значення: д64,
    назва: адреса<ПредметТексту>,
    місцезнаходження: Місцезнаходження
  ) -> ЗначенняАбоСтанПадіння {
    змінна предмет_методу = знайти_метод_в_структурі(
      М,
      М.предмет_структури_Дробове,
      назва
    );

    якщо предмет_методу == пусто {
      вернути значення_недійсне();
    }

    вернути значення_предмет(предмет_методу);
  }
}