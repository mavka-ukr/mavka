взяти означення мавка/машина;

простір мавка {
  місцева дія заповнити_структуру_Структура(
    М: адреса<Машина>
  ) {
    М.предмет_структури_Структура.заборонити_наслідування = так;
  }

  місцева дія створити_структуру(
    М: адреса<Машина>,
    назва: адреса<ПредметТексту>,
    предок: адреса<ПредметСтруктури>,
    параметри: адреса<ПредметПослідовності>
  ) -> адреса<ПредметСтруктури> {
    змінна предмет = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);

    предмет.заборонити_наслідування = ні;
    предмет.назва = назва;
    предмет.предок = предок;
    предмет.параметри = параметри;
    предмет.методи = Методи { 0, пусто };
    предмет.властивості = Властивості { 0, пусто, 0 };

    вернути предмет;
  }

  // позначка: прохід по типах предметів
  місцева дія предмет_структури_здійснити(
    М: адреса<Машина>,
    предмет_структури: адреса<ПредметСтруктури>,
    задіяні: Задіяні,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо предмет_структури == М.предмет_структури_Предмет {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Предмет\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Модуль {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Модуль\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Параметр {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Параметр\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Число {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Число\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Ціле {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Ціле\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Дробове {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Дробове\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Текст {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Текст\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Код {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Код\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Дія {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Дія\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Список {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Список\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Словник {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Словник\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Дані {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Дані\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ДіапазонЦілих {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ДіапазонЦілих\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ДіапазонДробових {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ДіапазонДробових\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірДіапазонуЦілих {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірДіапазонуЦілих\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірДаних {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірДаних\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірДіапазонуДробових {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірДіапазонуДробових\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірПослідовності {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірПослідовності\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірСловника {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірСписку\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірСписку {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірСписку\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_ПеребірТексту {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"ПеребірТексту\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    якщо предмет_структури == М.предмет_структури_Послідовність {
      увімкнути_стан_падіння(
        М,
        створити_текст(М, "Неможливо здійснити структуру \"Послідовність\".") як адреса<Предмет>,
        місцезнаходження
      );
      вернути пусто;
    }

    змінна предмет = створити_складений_предмет(М, предмет_структури);

    змінна предмет_метода = знайти_метод_в_структурі(
      М,
      предмет_структури,
      М.константи_назв._чародія
    );

    якщо предмет_метода != пусто {
      предмет_дії_здійснити(
        М,
        предмет як адреса<Предмет>,
        предмет_метода,
        задіяні,
        місцезнаходження
      );

      вернути предмет як адреса<Предмет>;
    }

    покласти_в_історію_здійснення(
      М,
      пусто,
      предмет як адреса<Предмет>,
      пусто,
      задіяні,
      місцезнаходження
    );

    якщо предмет_структури.параметри.розмір > 0 {
      змінна п: природне = 0;

      поки п < предмет_структури.параметри.розмір {
        змінна параметр = предмет_структури.параметри.елементи[п];
        змінна властивості_параметра = параметр як адреса<ПредметПараметра>;

        якщо задіяні.розмір > п {
          записати_властивість(
            М,
            предмет.властивості::адреса,
            властивості_параметра.назва,
            задіяні.дані[п]
          );
        }

        п += 1;
      }

      якщо задіяні.іменовано_задіяні != пусто {
        п = 0;

        поки п < задіяні.іменовано_задіяні.розмір {
          змінна іменовано_задіяне = задіяні.іменовано_задіяні.елементи[п];

          записати_властивість(
            М,
            предмет.властивості::адреса,
            іменовано_задіяне.назва,
            іменовано_задіяне.значення
          );

          п += 1;
        }
      }
    }

    видалити_з_історії_здійснення(М, 1);

    вернути предмет як адреса<Предмет>;
  }

  місцева дія записати_метод_структури(
    М: адреса<Машина>,
    предмет_структури: адреса<ПредметСтруктури>,
    назва: адреса<ПредметТексту>,
    значення_дії: адреса<ПредметДії>
  ) {
    змінна п: природне = 0;

    поки п < предмет_структури.методи.розмір {
      змінна метод = предмет_структури.методи.дані[п]::адреса;

      якщо перевірити_чи_значення_рівні(М, метод.назва як адреса<Предмет>, назва як адреса<Предмет>) {
        метод.значення = значення_дії;

        вернути;
      }

      п += 1;
    }

    предмет_структури.методи.дані = перевиділити_памʼять<Метод>(М, предмет_структури.методи.дані, предмет_структури.методи.розмір + 1);
    предмет_структури.методи.дані[предмет_структури.методи.розмір] = Метод { назва, значення_дії };
    предмет_структури.методи.розмір += 1;
  }

  місцева дія знайти_метод_в_структурі(
    М: адреса<Машина>,
    предмет_структури: адреса<ПредметСтруктури>,
    назва: адреса<ПредметТексту>
  ) -> адреса<ПредметДії> {
    змінна п: природне = 0;

    поки п < предмет_структури.методи.розмір {
      змінна метод = предмет_структури.методи.дані[п];

      якщо метод.назва == назва або перевірити_чи_предмети_тексту_рівні(М, метод.назва, назва) {
        вернути метод.значення;
      }

      п += 1;
    }

    якщо предмет_структури.предок != пусто {
      вернути знайти_метод_в_структурі(
        М,
        предмет_структури.предок,
        назва
      );
    }

    вернути пусто;
  }

  місцева дія предмет_структури_змінити_властивість(
    М: адреса<Машина>,
    предмет_структури: адреса<ПредметСтруктури>,
    назва: адреса<ПредметТексту>,
    значення: адреса<Предмет>,
    місцезнаходження: Місцезнаходження
  ) {
    записати_властивість(М, предмет_структури.властивості::адреса, назва, значення);
  }

  місцева дія предмет_структури_отримати_властивість(
    М: адреса<Машина>,
    предмет_структури: адреса<ПредметСтруктури>,
    назва: адреса<ПредметТексту>,
    місцезнаходження: Місцезнаходження
  ) -> ПредметАбоСтанПадіння {
    якщо назва == М.константи_назв._назва або перевірити_чи_предмети_тексту_рівні(М, назва, М.константи_назв._назва) {
      вернути предмет_структури.назва як адреса<Предмет>;
    }

    якщо назва == М.константи_назв._предок або перевірити_чи_предмети_тексту_рівні(М, назва, М.константи_назв._предок) {
      якщо предмет_структури.предок == пусто {
        вернути пусто;
      }

      вернути предмет_структури.предок як адреса<Предмет>;
    }

    якщо назва == М.константи_назв._параметри або перевірити_чи_предмети_тексту_рівні(М, назва, М.константи_назв._параметри) {
      вернути предмет_структури.параметри як адреса<Предмет>;
    }

    змінна значення_властивості: адреса<Предмет> = пусто;

    якщо знайти_властивість(
      М,
      предмет_структури.властивості,
      назва,
      значення_властивості::адреса
    ) {
      вернути значення_властивості;
    }

    змінна предмет_методу = знайти_метод_в_структурі(
      М,
      М.предмет_структури_Структура,
      назва
    );

    якщо предмет_методу == пусто {
      вернути пусто;
    }

    вернути предмет_методу як адреса<Предмет>;
  }
}