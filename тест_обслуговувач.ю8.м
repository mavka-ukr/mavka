взяти біб інтернет

структура ПідключенийКлієнт
  оф
кінець

підключені_клієнти = [=]

дія надіслати_всім(обслуговувач, повідомлення)
  перебрати підключені_клієнти.ключі() як п
    обслуговувач.надіслати(п, повідомлення)
  кінець
кінець

дія обробити_зупинку(обслуговувач, помилка)
  друк("Обслуговувач зупинено!")
кінець

дія обробити_підключення(обслуговувач, клієнт, адреса, порт)
  друк("підключення", клієнт, адреса, порт)
  підключені_клієнти[клієнт] = ПідключенийКлієнт(клієнт)
кінець

дія обробити_відключення(обслуговувач, клієнт)
  друк("відключення", клієнт)
  видалити підключені_клієнти[клієнт]
кінець

дія обробити_повідомлення(обслуговувач, клієнт, повідомлення)
  друк("повідомлення", клієнт, юнікод(повідомлення))
  надіслати_всім(обслуговувач, повідомлення)
кінець

обслуговувач = інтернет.створити_обслуговувач("0.0.0.0", 8080)

друк(обслуговувач)

обслуговувач.обробник_зупинки = обробити_зупинку
обслуговувач.обробник_підключення = обробити_підключення
обслуговувач.обробник_відключення = обробити_відключення
обслуговувач.обробник_повідомлення = обробити_повідомлення

обслуговувач.запустити(
  дія(обслуговувач, помилка)
    якщо помилка
      друк("Помилка запуску обслуговувача: ", помилка)
    інакше
      друк("Обслуговувач запущено!")
    кінець
  кінець
)