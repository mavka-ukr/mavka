взяти біб інтернет

структура ПідключенийКлієнт
  оф
кінець

підключені_клієнти = [=]

дія надіслати_всім(обслуговувач, дані)
  перебрати підключені_клієнти.ключі() як п
    обслуговувач.надіслати(п, дані)
  кінець
кінець

дія обробити_зупинку(обслуговувач, помилка)
  друк("Обслуговувач зупинено!")
кінець

дія обробити_підключення(обслуговувач, клієнт, адреса, порт)
  друк("підключення", клієнт, адреса, порт)
  підключені_клієнти[клієнт] = ПідключенийКлієнт(клієнт)
кінець

дія обробити_відключення(обслуговувач, клієнт)
  друк("відключення", клієнт)
  видалити підключені_клієнти[клієнт]
кінець

дія обробити_дані(обслуговувач, клієнт, дані)
  якщо юнікод(дані) == ю"stop\n"
    обслуговувач.зупинити()
  кінець
  вивести("дані", клієнт, юнікод(дані))
  надіслати_всім(обслуговувач, дані)
кінець

обслуговувач = інтернет.створити_обслуговувач("0.0.0.0", 8080)

обслуговувач.обробник_зупинки = обробити_зупинку
обслуговувач.обробник_підключення = обробити_підключення
обслуговувач.обробник_відключення = обробити_відключення
обслуговувач.обробник_даних = обробити_дані

обслуговувач.запустити(
  дія(обслуговувач, помилка)
    якщо помилка
      друк("Помилка запуску обслуговувача: ", помилка)
    інакше
      друк(обслуговувач)
    кінець
  кінець
)