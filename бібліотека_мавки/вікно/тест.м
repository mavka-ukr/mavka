взяти біб вікно
взяти біб планувальник

РЕЖИМ_ПЕРЕГЛЯД = 0
РЕЖИМ_РЕДАГУВАННЯ = 1

структура Стан
  ікс_миші = 0
  ігр_миші = 0
  буфер_тексту = Буфер.виділити(1024)
  довжина_тексту = 0
  розмір_шрифту = 16
  режим = РЕЖИМ_ПЕРЕГЛЯД
кінець

стан = Стан()

дія налаштувати()
  ;; вікно.встановити_бажану_ккс(60)
кінець

ВИДАЛИТИ = 259
ЕНТЕР = 257
ШИФТ = 340
КОНТРОЛ = 341
ЕСК = 256

дія оновитись()
  ікс_миші = вікно.ікс_миші()
  ігр_миші = вікно.ігр_миші()
  рух_колеса_миші = вікно.рух_колеса_миші()
  натиснутий_символ = вікно.натиснутий_символ()
  натиснута_клавіша = вікно.натиснута_клавіша()
  стан.ікс_миші = ікс_миші
  стан.ігр_миші = ігр_миші
  
  якщо вікно.клавішу_затиснуто(ШИФТ)
    якщо рух_колеса_миші
      планувальник.відкласти(дія()
       стан.розмір_шрифту += рух_колеса_миші * 5
      кінець, 100)
    кінець
  кінець

  якщо натиснута_клавіша == ЕСК
    якщо стан.режим == РЕЖИМ_РЕДАГУВАННЯ
      стан.режим = РЕЖИМ_ПЕРЕГЛЯД
    кінець
  кінець

  якщо стан.режим == РЕЖИМ_РЕДАГУВАННЯ
    якщо натиснута_клавіша
      друк(натиснута_клавіша)
      якщо натиснута_клавіша == ЕНТЕР
        стан.буфер_тексту[стан.довжина_тексту] = '\р'
        стан.довжина_тексту += 1
      кінець
    кінець
    якщо натиснутий_символ
      стан.буфер_тексту[стан.довжина_тексту] = натиснутий_символ
      стан.довжина_тексту += 1
    кінець
  інакше якщо стан.режим == РЕЖИМ_ПЕРЕГЛЯД
    якщо натиснутий_символ == 'р'
      стан.режим = РЕЖИМ_РЕДАГУВАННЯ
    кінець
  кінець
кінець

дія відмалювати()
  вікно.очистити_фон(21, 40, 25, 0)
  вікно.написати(текст(стан.буфер_тексту), 16, 16, стан.розмір_шрифту, 1)
  якщо стан.режим == РЕЖИМ_РЕДАГУВАННЯ
    вікно.написати("РЕДАГУВАННЯ", 0, 450-16, 16, 1)
  інакше
    вікно.написати("ПЕРЕГЛЯД", 0, 450-16, 16, 1)
  кінець
кінець

дія після_закриття()
кінець

ДОЗВОЛИТИ_ЗМІНЮВАТИ_РОЗМІР = 4
СПРОБУВАТИ_ХАЙДІПІАЙ = 8192
СПРОБУВАТИ_ВІСИНК = 64
СПРОБУВАТИ_МСАА_4ІКС = 32

вікно.ініціалізувати(
  800, 
  450, 
  "привіт",
  налаштувати, 
  оновитись, 
  відмалювати,
  після_закриття,
  СПРОБУВАТИ_ХАЙДІПІАЙ
)