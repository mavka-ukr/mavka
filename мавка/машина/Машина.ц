/* Машина Мавки */

взяти означення мавка;

простір мавка {
  місцева дія налаштувати_машину(М: адреса<Машина>, налаштування: Налаштування) {
    М.налаштування = налаштування;
    М.значення_дійсне = виділити_дійсне(М);
    М.значення_дійсне.тип = М.значення_дійсне;
    М.значення_дійсність = виділити_дійсне(М);
    М.значення_послідовність = виділити_дійсне(М);
    М.значення_предмет = виділити_дійсне(М);
    
    змінна предмет_структури_Структура = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    предмет_структури_Структура.тип = М.предмет_структури_Структура;
    М.предмет_структури_Структура = предмет_структури_Структура;

    змінна предмет_структури_Модуль = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Модуль = предмет_структури_Модуль;

    змінна предмет_структури_Параметр = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Параметр = предмет_структури_Параметр;

    змінна предмет_структури_Число = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Число = предмет_структури_Число;

    змінна предмет_структури_Ціле = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Ціле = предмет_структури_Ціле;

    змінна предмет_структури_Дробове = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Дробове = предмет_структури_Дробове;

    змінна предмет_структури_Текст = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Текст = предмет_структури_Текст;

    змінна предмет_структури_Код = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Код = предмет_структури_Код;

    змінна предмет_структури_Дія = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Дія = предмет_структури_Дія;

    змінна предмет_структури_Список = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Список = предмет_структури_Список;

    змінна предмет_структури_Словник = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Словник = предмет_структури_Словник;

    змінна предмет_структури_Дані = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_Дані = предмет_структури_Дані;

    змінна предмет_структури_ЗмінніДані = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_ЗмінніДані = предмет_структури_ЗмінніДані;

    змінна предмет_структури_ДіапазонЦілих = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_ДіапазонЦілих = предмет_структури_ДіапазонЦілих;

    змінна предмет_структури_ДіапазонДробових = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_ДіапазонДробових = предмет_структури_ДіапазонДробових;

    змінна предмет_структури_ПеребірДіапазонуЦілих = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_ПеребірДіапазонуЦілих = предмет_структури_ПеребірДіапазонуЦілих;

    змінна предмет_структури_ПеребірДіапазонуДробових = виділити_предмет<ПредметСтруктури>(М, М.предмет_структури_Структура);
    М.предмет_структури_ПеребірДіапазонуДробових = предмет_структури_ПеребірДіапазонуДробових;

    М.константи_назв = КонстантиНазв {
      _значення = створити_текст(М, "значення"),
      _дійсне = створити_текст(М, "дійсне"),
      _послідовність = створити_текст(М, "послідовність"),
      _дійсність = створити_текст(М, "дійсність"),
      _предмет = створити_текст(М, "предмет"),
      _Структура = створити_текст(М, "Структура"),
      _Модуль = створити_текст(М, "Модуль"),
      _Параметр = створити_текст(М, "Параметр"),
      _Число = створити_текст(М, "Число"),
      _Ціле = створити_текст(М, "Ціле"),
      _Дробове = створити_текст(М, "Дробове"),
      _Текст = створити_текст(М, "Текст"),
      _Код = створити_текст(М, "Код"),
      _Дія = створити_текст(М, "Дія"),
      _Список = створити_текст(М, "Список"),
      _Словник = створити_текст(М, "Словник"),
      _Дані = створити_текст(М, "Дані"),
      _ЗмінніДані = створити_текст(М, "ЗмінніДані"),
      _ДіапазонЦілих = створити_текст(М, "ДіапазонЦілих"),
      _ДіапазонДробових = створити_текст(М, "ДіапазонДробових"),
      _ПеребірДіапазонуЦілих = створити_текст(М, "ПеребірДіапазонуЦілих"),
      _ПеребірДіапазонуДробових = створити_текст(М, "ПеребірДіапазонуДробових"),
      _далі = створити_текст(М, "далі"),
      _з = створити_текст(М, "з"),
      _чародія_ціле = створити_текст(М, "чародія_ціле"),
      _чародія_текст = створити_текст(М, "чародія_текст"),
      _довжина = створити_текст(М, "довжина"),
    };

    предмет_структури_Структура.заборонити_наслідування = так;
    предмет_структури_Структура.назва = М.константи_назв._Структура;

    предмет_структури_Модуль.заборонити_наслідування = так;
    предмет_структури_Модуль.назва = М.константи_назв._Модуль;
    
    предмет_структури_Параметр.заборонити_наслідування = так;
    предмет_структури_Параметр.назва = М.константи_назв._Параметр;
    
    заповнити_структуру_Текст(М);
    
    предмет_структури_Число.заборонити_наслідування = так;
    предмет_структури_Число.назва = М.константи_назв._Число;

    заповнити_структуру_Ціле(М);

    предмет_структури_Дробове.заборонити_наслідування = так;
    предмет_структури_Дробове.назва = М.константи_назв._Дробове;
    
    предмет_структури_Код.заборонити_наслідування = так;
    предмет_структури_Код.назва = М.константи_назв._Код;
    
    предмет_структури_Дія.заборонити_наслідування = так;
    предмет_структури_Дія.назва = М.константи_назв._Дія;
    
    предмет_структури_Список.заборонити_наслідування = так;
    предмет_структури_Список.назва = М.константи_назв._Список;
    
    предмет_структури_Словник.заборонити_наслідування = так;
    предмет_структури_Словник.назва = М.константи_назв._Словник;
    
    предмет_структури_Дані.заборонити_наслідування = так;
    предмет_структури_Дані.назва = М.константи_назв._Дані;
    
    предмет_структури_ЗмінніДані.заборонити_наслідування = так;
    предмет_структури_ЗмінніДані.назва = М.константи_назв._ЗмінніДані;
    
    предмет_структури_ДіапазонЦілих.заборонити_наслідування = так;
    предмет_структури_ДіапазонЦілих.назва = М.константи_назв._ДіапазонЦілих;
    
    предмет_структури_ДіапазонДробових.заборонити_наслідування = так;
    предмет_структури_ДіапазонДробових.назва = М.константи_назв._ДіапазонДробових;
    
    заповнити_структуру_ПеребірДіапазонуДробових(М);
    заповнити_структуру_ПеребірДіапазонуЦілих(М);

    М.глобальна_дійсність = створити_дійсність(М, пусто, пусто);

    стала вмісткість_накопичувача_значень = 1024;
    М.накопичувач_значень = НакопичувачЗначень {
      розмір = 0,
      дані = виділити_памʼять<Значення>(М, вмісткість_накопичувача_значень),
      вмісткість = вмісткість_накопичувача_значень
    };

    стала вмісткість_історії_здійснення = 1024;
    М.історія_здійснення = ІсторіяЗдійснення {
      розмір = 0,
      дані = виділити_памʼять<Здійснюване>(М, вмісткість_історії_здійснення),
      вмісткість = вмісткість_історії_здійснення
    };

    М.стан_падіння = ні;
    М.значення_падіння = пусто;
    М.місцезнаходження_падіння = Місцезнаходження { пусто, 0 };

    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._дійсне, М.значення_дійсне);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._послідовність, М.значення_послідовність);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._дійсність, М.значення_дійсність);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._предмет, М.значення_предмет);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Структура, М.предмет_структури_Структура як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Модуль, М.предмет_структури_Модуль як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Параметр, М.предмет_структури_Параметр як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Число, М.предмет_структури_Число як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Ціле, М.предмет_структури_Ціле як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Дробове, М.предмет_структури_Дробове як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Текст, М.предмет_структури_Текст як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Код, М.предмет_структури_Код як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Дія, М.предмет_структури_Дія як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Список, М.предмет_структури_Список як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Словник, М.предмет_структури_Словник як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._Дані, М.предмет_структури_Дані як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._ЗмінніДані, М.предмет_структури_ЗмінніДані як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._ДіапазонЦілих, М.предмет_структури_ДіапазонЦілих як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._ДіапазонДробових, М.предмет_структури_ДіапазонДробових як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._ПеребірДіапазонуЦілих, М.предмет_структури_ПеребірДіапазонуЦілих як Значення);
    визначити_в_дійсності(М, М.глобальна_дійсність, М.константи_назв._ПеребірДіапазонуДробових, М.предмет_структури_ПеребірДіапазонуДробових як Значення);
  }

  місцева дія створити_машину(налаштування: Налаштування) -> адреса<Машина> {
    змінна М = налаштування.виділити_сиру_памʼять(пусто, Машина.розмір) як адреса<Машина>;
  
    налаштувати_машину(М, налаштування);
  
    вернути М;
  }

  місцева дія увімкнути_стан_падіння(М: адреса<Машина>, значення_падіння: Значення, місцезнаходження_падіння: Місцезнаходження) -> ніщо {
    М.стан_падіння = так;
    М.значення_падіння = значення_падіння;
    М.місцезнаходження_падіння = місцезнаходження_падіння;
  }

  місцева дія покласти_спробу(М: адреса<Машина>, спроби: адреса<Спроби>, спроба: Спроба) {
    спроби.дані = перевиділити_памʼять<Спроба>(М, спроби.дані, спроби.розмір + 1);
    спроби.дані[спроби.розмір] = спроба;
    спроби.розмір += 1;
  }

  місцева дія видалити_останню_спробу(М: адреса<Машина>, спроби: адреса<Спроби>) {
    якщо спроби.розмір == 0 {
      запанікувати(М, "Немає спроб для видалення.");
      вернути;
    }

    спроби.розмір -= 1;
  }

  місцева дія покласти_в_накопичувач_значень(М: адреса<Машина>, значення: Значення) {
    якщо М.накопичувач_значень.розмір == М.накопичувач_значень.вмісткість {
      запанікувати(М, "Накопичувач значень заповнено!");
      вернути;
    }

    М.накопичувач_значень.дані[М.накопичувач_значень.розмір] = значення;
    М.накопичувач_значень.розмір += 1;
  }

  місцева дія забрати_з_накопичувача_значень(М: адреса<Машина>) -> Значення {
    якщо М.накопичувач_значень.розмір == 0 {
      запанікувати(М, "Накопичувач значень порожній 1!");
    }

    М.накопичувач_значень.розмір -= 1;
    вернути М.накопичувач_значень.дані[М.накопичувач_значень.розмір];
  }

  місцева дія отримати_з_накопичувача_значень(М: адреса<Машина>, позиція: природне) -> Значення {
    якщо М.накопичувач_значень.розмір == 0 {
      запанікувати(М, "Накопичувач значень порожній 2!");
    }

    вернути М.накопичувач_значень.дані[М.накопичувач_значень.розмір - 1 - позиція];
  }

  місцева дія видалити_з_накопичувача_значень(М: адреса<Машина>, кількість: природне) {
    якщо М.накопичувач_значень.розмір == 0 {
      запанікувати(М, "Накопичувач значень порожній 3!");
    }
    
    М.накопичувач_значень.розмір -= кількість;
  }

  місцева дія виконати_взяти(М: адреса<Машина>, модуль: Значення, звідки: Значення, довжина_шляху: природне, шлях: памʼять<Значення>, місцезнаходження: Місцезнаходження) -> Значення {
    вернути пусто;
  }
}