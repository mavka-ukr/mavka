/* Машина Мавки */

взяти означення мавка;

простір мавка {
  місцева дія налаштувати_машину(М: адреса<Машина>, налаштування: Налаштування) {
    М.налаштування = налаштування;
    М.значення_дійсне = виділити_дійсне(М);
    М.значення_дійсне.тип = М.значення_дійсне;
    М.значення_дійсність = виділити_дійсне(М);
    М.значення_послідовність = виділити_дійсне(М);
    М.значення_предмет = виділити_дійсне(М);
    
    змінна значення_структура_Структура = виділити_предмет(М, пусто);
    значення_структура_Структура.тип = М.значення_структура_Структура;
    М.значення_структура_Структура = значення_структура_Структура як Значення;

    змінна значення_структура_Модуль = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Модуль = значення_структура_Модуль як Значення;

    змінна значення_структура_Параметр = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Параметр = значення_структура_Параметр як Значення;

    змінна значення_структура_Число = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Число = значення_структура_Число як Значення;

    змінна значення_структура_Ціле = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Ціле = значення_структура_Ціле як Значення;

    змінна значення_структура_Дробове = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Дробове = значення_структура_Дробове як Значення;

    змінна значення_структура_Текст = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Текст = значення_структура_Текст як Значення;

    змінна значення_структура_Код = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Код = значення_структура_Код як Значення;

    змінна значення_структура_Дія = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Дія = значення_структура_Дія як Значення;

    змінна значення_структура_Список = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Список = значення_структура_Список як Значення;

    змінна значення_структура_Словник = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Словник = значення_структура_Словник як Значення;

    змінна значення_структура_Дані = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_Дані = значення_структура_Дані як Значення;

    змінна значення_структура_ЗмінніДані = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_ЗмінніДані = значення_структура_ЗмінніДані як Значення;

    змінна значення_структура_ДіапазонЦілих = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_ДіапазонЦілих = значення_структура_ДіапазонЦілих як Значення;

    змінна значення_структура_ДіапазонДробових = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_ДіапазонДробових = значення_структура_ДіапазонДробових як Значення;

    змінна значення_структура_ПеребірДіапазонуЦілих = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_ПеребірДіапазонуЦілих = значення_структура_ПеребірДіапазонуЦілих як Значення;

    змінна значення_структура_ПеребірДіапазонуДробових = виділити_предмет(М, М.значення_структура_Структура);
    М.значення_структура_ПеребірДіапазонуДробових = значення_структура_ПеребірДіапазонуДробових як Значення;

    значення_структура_Структура.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Структура"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Модуль.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Модуль"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Параметр.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Параметр"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Текст.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Текст"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Число.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Число"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Ціле.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Ціле"),
      предок = М.значення_структура_Число,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Дробове.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Дробове"),
      предок = М.значення_структура_Число,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Код.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Код"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Дія.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Дія"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Список.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Список"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Словник.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Словник"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_Дані.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "Дані"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_ЗмінніДані.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "ЗмінніДані"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_ДіапазонЦілих.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "ДіапазонЦілих"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_ДіапазонДробових.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "ДіапазонДробових"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_ПеребірДіапазонуЦілих.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "ПеребірДіапазонуЦілих"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    значення_структура_ПеребірДіапазонуДробових.властивості = ВластивостіСтруктури {
      заборонити_наслідування = так,
      назва = створити_текст(М, "ПеребірДіапазонуДробових"),
      предок = М.значення_предмет,
      параметри = пусто,
      методи = Методи { 0, пусто }
    };

    М.глобальна_дійсність = створити_дійсність(М, пусто, пусто);

    стала вмісткість_накопичувача_значень = 1024;
    М.накопичувач_значень = НакопичувачЗначень {
      розмір = 0,
      дані = виділити_памʼять<Значення>(М, вмісткість_накопичувача_значень),
      вмісткість = вмісткість_накопичувача_значень
    };

    стала вмісткість_історії_здійснення = 1024;
    М.історія_здійснення = ІсторіяЗдійснення {
      розмір = 0,
      дані = виділити_памʼять<Здійснюване>(М, вмісткість_історії_здійснення),
      вмісткість = вмісткість_історії_здійснення
    };

    М.стан_падіння = ні;
    М.значення_падіння = пусто;
    М.місцезнаходження_падіння = Місцезнаходження { пусто, 0 };

    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "дійсне"), М.значення_дійсне);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "послідовність"), М.значення_послідовність);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "дійсність"), М.значення_дійсність);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "предмет"), М.значення_предмет);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Структура"), М.значення_структура_Структура);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Модуль"), М.значення_структура_Модуль);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Параметр"), М.значення_структура_Параметр);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Число"), М.значення_структура_Число);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Ціле"), М.значення_структура_Ціле);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Дробове"), М.значення_структура_Дробове);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Текст"), М.значення_структура_Текст);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Код"), М.значення_структура_Код);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Дія"), М.значення_структура_Дія);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Список"), М.значення_структура_Список);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Словник"), М.значення_структура_Словник);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "Дані"), М.значення_структура_Дані);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "ЗмінніДані"), М.значення_структура_ЗмінніДані);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "ДіапазонЦілих"), М.значення_структура_ДіапазонЦілих);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "ДіапазонДробових"), М.значення_структура_ДіапазонДробових);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "ПеребірДіапазонуЦілих"), М.значення_структура_ПеребірДіапазонуЦілих);
    визначити_в_дійсності(М, М.глобальна_дійсність, створити_текст(М, "ПеребірДіапазонуДробових"), М.значення_структура_ПеребірДіапазонуДробових);
  }

  місцева дія створити_машину(налаштування: Налаштування) -> адреса<Машина> {
    змінна М = налаштування.виділити_сиру_памʼять(пусто, Машина.розмір) як адреса<Машина>;
  
    налаштувати_машину(М, налаштування);
  
    вернути М;
  }

  місцева дія увімкнути_стан_падіння(М: адреса<Машина>, значення_падіння: Значення, місцезнаходження_падіння: Місцезнаходження) -> ніщо {
    М.стан_падіння = так;
    М.значення_падіння = значення_падіння;
    М.місцезнаходження_падіння = місцезнаходження_падіння;
  }

  місцева дія покласти_спробу(М: адреса<Машина>, спроби: адреса<Спроби>, спроба: Спроба) {
    спроби.дані = перевиділити_памʼять<Спроба>(М, спроби.дані, спроби.розмір + 1);
    спроби.дані[спроби.розмір] = спроба;
    спроби.розмір += 1;
  }

  місцева дія видалити_останню_спробу(М: адреса<Машина>, спроби: адреса<Спроби>) {
    якщо спроби.розмір == 0 {
      запанікувати(М, "Немає спроб для видалення.");
      вернути;
    }

    спроби.розмір -= 1;
  }

  місцева дія покласти_в_накопичувач_значень(М: адреса<Машина>, значення: Значення) {
    якщо М.накопичувач_значень.розмір == М.накопичувач_значень.вмісткість {
      запанікувати(М, "Накопичувач значень заповнено!");
      вернути;
    }

    М.накопичувач_значень.дані[М.накопичувач_значень.розмір] = значення;
    М.накопичувач_значень.розмір += 1;
  }

  місцева дія забрати_з_накопичувача_значень(М: адреса<Машина>) -> Значення {
    якщо М.накопичувач_значень.розмір == 0 {
      запанікувати(М, "Накопичувач значень порожній 1!");
    }

    М.накопичувач_значень.розмір -= 1;
    вернути М.накопичувач_значень.дані[М.накопичувач_значень.розмір];
  }

  місцева дія отримати_з_накопичувача_значень(М: адреса<Машина>, позиція: природне) -> Значення {
    якщо М.накопичувач_значень.розмір == 0 {
      запанікувати(М, "Накопичувач значень порожній 2!");
    }

    вернути М.накопичувач_значень.дані[М.накопичувач_значень.розмір - 1 - позиція];
  }

  місцева дія видалити_з_накопичувача_значень(М: адреса<Машина>, кількість: природне) {
    якщо М.накопичувач_значень.розмір == 0 {
      запанікувати(М, "Накопичувач значень порожній 3!");
    }
    
    М.накопичувач_значень.розмір -= кількість;
  }

  місцева дія виконати_взяти(М: адреса<Машина>, модуль: Значення, звідки: Значення, довжина_шляху: природне, шлях: памʼять<Значення>, місцезнаходження: Місцезнаходження) -> Значення {
    вернути пусто;
  }
}