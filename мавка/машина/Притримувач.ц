взяти означення машина_мавки;

простір мавка {
  місцева дія створити_притримувач(
    М: адреса<Машина>
  ) -> адреса<Притримувач> {
    змінна притримувач = виділити<Притримувач>(М);

    притримувач.попередній = М.останній_притримувач;
    притримувач.наступний = пусто;
    притримувач.перше = пусто;
    притримувач.останнє = пусто;

    М.останній_притримувач.наступний = притримувач;
    М.останній_притримувач = притримувач;

    вернути притримувач;
  }

  місцева дія знищити_притримувач(
    М: адреса<Машина>,
    притримувач: адреса<Притримувач>
  ) {
    якщо М.глобальний_притримувач == притримувач {
      вернути;
    }

    якщо притримувач.попередній != пусто {
      притримувач.попередній.наступний = притримувач.наступний;
    }

    якщо притримувач.наступний != пусто {
      притримувач.наступний.попередній = притримувач.попередній;
    }

    якщо М.останній_притримувач == притримувач {
      М.останній_притримувач = притримувач.попередній;
    }
  }

  місцева дія притримати(
    М: адреса<Машина>,
    притримувач: адреса<Притримувач>,
    значення: Значення
  ) -> адреса<Притримане> {
    змінна притримане = виділити<Притримане>(М);

    притримане.попереднє = притримувач.останнє;
    притримане.наступне = пусто;
    притримане.значення = значення;

    якщо притримувач.останнє != пусто {
      притримувач.останнє.наступне = притримане;
    }
    притримувач.останнє = притримане;

    якщо притримувач.перше == пусто {
      притримувач.перше = притримане;
    }

    вернути притримане;
  }

  місцева дія відпустити_притримане(
    М: адреса<Машина>,
    притримувач: адреса<Притримувач>,
    притримане: адреса<Притримане>
  ) {
    якщо притримане.попереднє != пусто {
      притримане.попереднє.наступне = притримане.наступне;
    }

    якщо притримане.наступне != пусто {
      притримане.наступне.попереднє = притримане.попереднє;
    }

    якщо притримувач.перше == притримане {
      притримувач.перше = притримане.наступне;
    }

    якщо притримувач.останнє == притримане {
      притримувач.останнє = притримане.попереднє;
    }
  }

  місцева дія притримати_глобально(
    М: адреса<Машина>,
    значення: Значення
  ) -> адреса<Притримане> {
    вернути притримати(М, М.глобальний_притримувач, значення);
  }

  місцева дія відпустити_притримане_глобально(
    М: адреса<Машина>,
    притримане: адреса<Притримане>
  ) {
    відпустити_притримане(М, М.глобальний_притримувач, притримане);
  }
}