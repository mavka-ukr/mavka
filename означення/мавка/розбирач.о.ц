/* Розбирач Мавки */

взяти означення мавка/машина;
взяти означення КД;

простір мавка {
  простір розбирач {
    структура можливо<Т>;

    структура можливо<Т> {
      заповнено: логічне;
      значення: Т;
    }

    структура ПомилкаРозборуНаСлова {
      позиція_в_тексті: природне;
      рядок: природне;
      стовпець: природне;
    }

    структура ПомилкаРозборуНаСполуки {
      позиція_слова: природне;
      рядок: природне;
      стовпець: природне;
    }

    стала ВидСловаАбо = 0;
    стала ВидСловаБільше = 1;
    стала ВидСловаВзяти = 2;
    стала ВидСловаВласна = 3;
    стала ВидСловаВпасти = 4;
    стала ВидСловаВидалити = 5;
    стала ВидСловаВнутрішня = 6;
    стала ВидСловаВластивість = 7;
    стала ВидСловаВернути = 8;
    стала ВидСловаДія = 9;
    стала ВидСловаДати = 10;
    стала ВидСловаЄ = 11;
    стала ВидСловаЗовнішня = 12;
    стала ВидСловаЗловити = 13;
    стала ВидСловаІ = 14;
    стала ВидСловаІнакше = 15;
    стала ВидСловаКомпозиція = 16;
    стала ВидСловаКінець = 17;
    стала ВидСловаМодуль = 18;
    стала ВидСловаМенше = 19;
    стала ВидСловаМістить = 20;
    стала ВидСловаМісцева = 21;
    стала ВидСловаНе = 22;
    стала ВидСловаПоки = 23;
    стала ВидСловаПерелік = 24;
    стала ВидСловаПеребрати = 26;
    стала ВидСловаРівно = 27;
    стала ВидСловаСтруктура = 28;
    стала ВидСловаСпробувати = 29;
    стала ВидСловаСпец = 30;
    стала ВидСловаТривала = 31;
    стала ВидСловаЦикл = 32;
    стала ВидСловаЦе = 33;
    стала ВидСловаЧекати = 34;
    стала ВидСловаЯк = 35;
    стала ВидСловаЯкщо = 36;

    стала ВидСловаСимволРівно = 37;
    стала ВидСловаСимволБільше = 38;
    стала ВидСловаСимволМенше = 39;
    стала ВидСловаСимволКрапка = 40;
    стала ВидСловаСимволПлюс = 41;
    стала ВидСловаСимволМінус = 42;
    стала ВидСловаСимволПомножити = 43;
    стала ВидСловаСимволПоділити = 44;
    стала ВидСловаСимволЗалишку = 45;
    стала ВидСловаСимволВиключнеАбо = 46;
    стала ВидСловаСимволІ = 47;
    стала ВидСловаСимволАбо = 48;
    стала ВидСловаСимволВідкритаДужка = 49;
    стала ВидСловаСимволЗакритаДужка = 50;
    стала ВидСловаСимволКвадратнаВідкритаДужка = 51;
    стала ВидСловаСимволКвадратнаЗакритаДужка = 52;
    стала ВидСловаСимволЗнакПитання = 53;
    стала ВидСловаСимволДвокрапка = 54;
    стала ВидСловаСимволДвійковеНе = 55;
    стала ВидСловаСимволОднолапка = 56;
    стала ВидСловаСимволДволапка = 57;
    стала ВидСловаСимволЗнакОклику = 58;
    стала ВидСловаСимволКома = 59;
    стала ВидСловаСимволМіжряд = 60;

    стала ВидСловаЦіле = 61;
    стала ВидСловаДробове = 62;
    стала ВидСловаСимвол = 63;
    стала ВидСловаТекст = 64;
    стала ВидСловаКоментар = 66;
    стала ВидСловаБагаторядковийКоментар = 67;
    стала ВидСловаІдентифікатор = 68;

    стала ВидСловаПочатокЗбитогоТексту = 69;
    стала ВидСловаРоздільникЗбитогоТексту = 70;
    стала ВидСловаКінецьЗбитогоТексту = 71;
    стала ВидСловаЧастинаЗбитогоТексту = 72;
    стала ВидСловаСимволФігурнаВідкритаДужка = 73;
    стала ВидСловаСимволФігурнаЗакритаДужка = 74;

    стала ВидСловаКІНЕЦЬСЛІВ = 100;

    стала КД_РОЗРИВ = КД::символи::Міжряд;
    стала КД_ПРОПУСК = КД::символи::Пропуск;
    стала КД_ДВОЛАПКА = КД::символи::Дволапка;
    стала КД_ВІДСОТОК = КД::символи::Відсоток;
    стала КД_ЛАПКА = КД::символи::Лапка;
    стала КД_ВІДКРИТА_ДУЖКА = КД::символи::Відкрита_дужка;
    стала КД_ЗАКРИТА_ДУЖКА = КД::символи::Закрита_дужка;
    стала КД_КРАПКА = КД::символи::Крапка;
    стала КД_0 = КД::символи::Нуль;
    стала КД_1 = КД::символи::Один;
    стала КД_2 = КД::символи::Два;
    стала КД_3 = КД::символи::Три;
    стала КД_4 = КД::символи::Чотири;
    стала КД_5 = КД::символи::Пʼять;
    стала КД_6 = КД::символи::Шість;
    стала КД_7 = КД::символи::Сім;
    стала КД_8 = КД::символи::Вісім;
    стала КД_9 = КД::символи::Девʼять;
    стала КД_ОБЕРНЕНА_ПОХИЛА = КД::символи::Обернена_похила;
    стала КД_ПІДРИСКА = КД::символи::Підриска;
    стала КД_д = КД::символи::Мала_буква_д;
    стала КД_р = КД::символи::Мала_буква_р;
    стала КД_ДІЯ = КД::символи::Дія;

    структура ПозиціяСлова {
      позиція_в_тексті: природне;
      рядок: природне;
      стовпець: природне;
    }

    структура Слово {
      вид: природне;
      позиція_початку: ПозиціяСлова;
      позиція_кінця: ПозиціяСлова;
    }

    структура Слова {
      розмір: природне;
      дані: памʼять<Слово>;
    }

    стала ВидСполукиНіщо = 0;
    стала ВидСполукиВизначити = 1;
    стала ВидСполукиЗвернутись = 2;
    стала ВидСполукиОтриматиВластивість = 3;
    стала ВидСполукиОтриматиЕлемент = 5;
    стала ВидСполукиЗмінитиВластивість = 6;
    стала ВидСполукиЗмінитиЕлемент = 8;
    стала ВидСполукиВиконати = 9;
    стала ВидСполукиДія = 12;
    стала ВидСполукиСтруктура = 13;
    стала ВидСполукиЦіле = 18;
    стала ВидСполукиДробове = 52;
    стала ВидСполукиТекст = 19;
    стала ВидСполукиОперація = 21;
    стала ВидСполукиЯкщо = 22;
    стала ВидСполукиПоки = 23;
    стала ВидСполукиВернути = 24;
    стала ВидСполукиЗначенняЯкщо = 27;
    стала ВидСполукиСамоОперація = 29;
    стала ВидСполукиВзяти = 33;
    стала ВидСполукиСпробувати = 34;
    стала ВидСполукиВпасти = 35;
    стала ВидСполукиДати = 36;
    стала ВидСполукиМодуль = 37;
    стала ВидСполукиСписок = 38;
    стала ВидСполукиСловник = 39;
    стала ВидСполукиСимвол = 40;
    стала ВидСполукиПеребрати = 41;
    стала ВидСполукиЦикл = 42;
    стала ВидСполукиВизначитиЗзовні = 43;
    стала ВидСполукиВічнийЦикл = 45;
    стала ВидСполукиВидалити = 46;
    стала ВидСполукиВидалитиВластивість = 47;
    стала ВидСполукиВидалитиЕлемент = 48;
    стала ВидСполукиЧекати = 49;
    стала ВидСполукиДіапазон = 50;
    стала ВидСполукиЗбитийТекст = 51; // 52

    стала ВидОпераціїМноження = 1;
    стала ВидОпераціїДілення = 2;
    стала ВидОпераціїМодуль = 3;
    стала ВидОпераціїДодавання = 4;
    стала ВидОпераціїВіднімання = 5;
    стала ВидОпераціїЗсувВліво = 6;
    стала ВидОпераціїЗсувВправо = 7;
    стала ВидОпераціїЗсувВправоЗнаковий = 8;
    стала ВидОпераціїМенше = 9;
    стала ВидОпераціїБільше = 10;
    стала ВидОпераціїМеншеРівне = 11;
    стала ВидОпераціїБільшеРівне = 12;
    стала ВидОпераціїРівне = 13;
    стала ВидОпераціїНерівне = 14;
    стала ВидОпераціїДІ = 15;
    стала ВидОпераціїВАБО = 16;
    стала ВидОпераціїДАБО = 17;
    стала ВидОпераціїІ = 18;
    стала ВидОпераціїАБО = 19;
    стала ВидОпераціїДіленняНаціло = 20;
    стала ВидОпераціїПіднесенняДоСтепеня = 21;
    стала ВидОпераціїМістить = 22;
    стала ВидОпераціїНеМістить = 23;
    стала ВидОпераціїЄ = 24;
    стала ВидОпераціїНеЄ = 25;

    стала ВидСамоОпераціїЛогічнеНі = 1;
    стала ВидСамоОпераціїДвійковеНі = 2;
    стала ВидСамоОпераціїПлюс = 3;
    стала ВидСамоОпераціїМінус = 4;

    структура Місцезнаходження;
    структура Сполука;
    структура Сполуки;

    структура Ідентифікатор;
    структура Параметр;
    структура Аргумент;
    структура ЕлементДати;
    структура ЕлементВзяти;
    структура ЕлементСловника;

    структура ДаніСполукиВизначити;
    структура ДаніСполукиЗвернутись;
    структура ДаніСполукиОтриматиВластивість;
    структура ДаніСполукиОтриматиЕлемент;
    структура ДаніСполукиЗмінитиВластивість;
    структура ДаніСполукиЗмінитиЕлемент;
    структура ДаніСполукиВиконати;
    структура ДаніСполукиДія;
    структура ДаніСполукиСтруктура;
    структура ДаніСполукиЦіле;
    структура ДаніСполукиДробове;
    структура ДаніСполукиТекст;
    структура ДаніСполукиСимвол;
    структура ДаніСполукиОперація;
    структура ДаніСполукиЯкщо;
    структура ДаніСполукиПоки;
    структура ДаніСполукиПеребрати;
    структура ДаніСполукиЦикл;
    структура ДаніСполукиВічнийЦикл;
    структура ДаніСполукиВернути;
    структура ДаніСполукиЗначенняЯкщо;
    структура ДаніСполукиСамоОперація;
    структура ДаніСполукиВзяти;
    структура ДаніСполукиСпробувати;
    структура ДаніСполукиВпасти;
    структура ДаніСполукиДати;
    структура ДаніСполукиМодуль;
    структура ДаніСполукиСписок;
    структура ДаніСполукиСловник;
    структура ДаніСполукиВизначитиЗзовні;
    структура ДаніСполукиВидалити;
    структура ДаніСполукиВидалитиВластивість;
    структура ДаніСполукиВидалитиЕлемент;
    структура ДаніСполукиЧекати;
    структура ДаніСполукиДіапазон;
    структура ДаніСполукиЗбитийТекст;

    структура Сполуки {
      розмір: природне;
      дані: памʼять<адреса<Сполука>>;
    }

    структура Місцезнаходження {
      позиція_слова: природне;
    }

    структура Ідентифікатор {
      позиція_слова: природне;
    }

    структура Тип {
      кількість_гілок: природне;
      сполуки: памʼять<адреса<Сполука>>;
    }

    структура Параметр {
      ідентифікатор: Ідентифікатор;
      тип: можливо<Тип>;
      значення: адреса<Сполука>;
      місцезнаходження: Місцезнаходження;
    }

    структура Аргумент {
      ідентифікатор: можливо<Ідентифікатор>;
      значення: адреса<Сполука>;
      місцезнаходження: Місцезнаходження;
    }

    структура ЕлементДати {
      ідентифікатор: Ідентифікатор;
      ідентифікатор_як: можливо<Ідентифікатор>;
      місцезнаходження: Місцезнаходження;
    }

    структура ЕлементВзяти {
      ідентифікатор: Ідентифікатор;
      ідентифікатор_як: можливо<Ідентифікатор>;
      місцезнаходження: Місцезнаходження;
    }

    структура ЕлементСловника {
      ключ: адреса<Сполука>;
      значення: адреса<Сполука>;
      місцезнаходження: Місцезнаходження;
    }

    структура ДаніСполукиВизначити {
      ідентифікатор: Ідентифікатор;
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиЗвернутись {
      ідентифікатор: Ідентифікатор;
    }

    структура ДаніСполукиОтриматиВластивість {
      предмет: адреса<Сполука>;
      ідентифікатор: Ідентифікатор;
    }

    структура ДаніСполукиОтриматиЕлемент {
      предмет: адреса<Сполука>;
      ключ: адреса<Сполука>;
    }

    структура ДаніСполукиЗмінитиВластивість {
      предмет: адреса<Сполука>;
      ідентифікатор: Ідентифікатор;
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиЗмінитиЕлемент {
      предмет: адреса<Сполука>;
      ключ: адреса<Сполука>;
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиВиконати {
      предмет: адреса<Сполука>;
      кількість_аргументів: природне;
      аргументи: памʼять<Аргумент>;
    }

    структура ДаніСполукиДія {
      тривала: логічне;
      власна: логічне;
      структура_: адреса<Сполука>;
      ідентифікатор: можливо<Ідентифікатор>;
      кількість_параметрів: природне;
      параметри: памʼять<Параметр>;
      тип_результату: можливо<Тип>;
      тіло: Сполуки;
    }

    структура ДаніСполукиСтруктура {
      ідентифікатор: можливо<Ідентифікатор>;
      предок: адреса<Сполука>;
      кількість_параметрів: природне;
      параметри: памʼять<Параметр>;
    }

    структура ДаніСполукиЦіле {
      позиція_слова: природне;
    }

    структура ДаніСполукиДробове {
      позиція_слова: природне;
    }

    структура ДаніСполукиТекст {
      ідентифікатор: можливо<Ідентифікатор>;
      позиція_слова: природне;
    }

    структура ДаніСполукиСимвол {
      ідентифікатор: можливо<Ідентифікатор>;
      позиція_слова: природне;
    }

    структура ДаніСполукиОперація {
      ліво: адреса<Сполука>;
      операція: природне;
      право: адреса<Сполука>;
    }

    структура ДаніСполукиЯкщо {
      умова: адреса<Сполука>;
      тіло: Сполуки;
      тіло_інакше: Сполуки;
    }

    структура ДаніСполукиПоки {
      умова: адреса<Сполука>;
      тіло: Сполуки;
    }

    структура ДаніСполукиПеребрати {
      предмет: адреса<Сполука>;
      ідентифікатор: можливо<Ідентифікатор>;
      тіло: Сполуки;
    }

    структура ДаніСполукиЦикл {
      старт: Сполуки;
      умова: адреса<Сполука>;
      тіло: Сполуки;
      ітерація: Сполуки;
    }

    структура ДаніСполукиВічнийЦикл {
      тіло: Сполуки;
    }

    структура ДаніСполукиВернути {
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиЗначенняЯкщо {
      умова: адреса<Сполука>;
      значення_так: адреса<Сполука>;
      значення_ні: адреса<Сполука>;
    }

    структура ДаніСполукиСамоОперація {
      операція: природне;
      предмет: адреса<Сполука>;
    }

    структура ДаніСполукиВзяти {
      тип: можливо<Ідентифікатор>;
      довжина_шляху: природне;
      шлях: памʼять<Ідентифікатор>;
      ідентифікатор_як: можливо<Ідентифікатор>;
      кількість_елементів: природне;
      елементи: памʼять<ЕлементВзяти>;
    }

    структура ДаніСполукиСпробувати {
      тіло: Сполуки;
      ідентифікатор_зловити: можливо<Ідентифікатор>;
      тіло_зловити: Сполуки;
    }

    структура ДаніСполукиВпасти {
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиДати {
      кількість_елементів: природне;
      елементи: памʼять<ЕлементДати>;
    }

    структура ДаніСполукиМодуль {
      ідентифікатор: можливо<Ідентифікатор>;
      тіло: Сполуки;
    }

    структура ДаніСполукиСписок {
      кількість_елементів: природне;
      елементи: памʼять<адреса<Сполука>>;
    }

    структура ДаніСполукиСловник {
      кількість_елементів: природне;
      елементи: памʼять<ЕлементСловника>;
    }

    структура ДаніСполукиВизначитиЗзовні {
      ідентифікатор: Ідентифікатор;
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиВидалити {
      ідентифікатор: Ідентифікатор;
    }

    структура ДаніСполукиВидалитиВластивість {
      предмет: адреса<Сполука>;
      ідентифікатор: Ідентифікатор;
    }

    структура ДаніСполукиВидалитиЕлемент {
      предмет: адреса<Сполука>;
      ключ: адреса<Сполука>;
    }

    структура ДаніСполукиЧекати {
      значення: адреса<Сполука>;
    }

    структура ДаніСполукиДіапазон {
      від: адреса<Сполука>;
      до: адреса<Сполука>;
      включно: логічне;
    }

    структура ДаніСполукиЗбитийТекст {
      ідентифікатор: можливо<Ідентифікатор>;
      кількість_гілок: природне;
      сполуки: памʼять<адреса<Сполука>>;
    }

    структура Сполука {
      вид: природне;
      дані: ДаніСполукиВизначити
          | ДаніСполукиЗвернутись
          | ДаніСполукиОтриматиВластивість
          | ДаніСполукиОтриматиЕлемент
          | ДаніСполукиЗмінитиВластивість
          | ДаніСполукиЗмінитиЕлемент
          | ДаніСполукиВиконати
          | ДаніСполукиДія
          | ДаніСполукиСтруктура
          | ДаніСполукиЦіле
          | ДаніСполукиДробове
          | ДаніСполукиТекст
          | ДаніСполукиСимвол
          | ДаніСполукиОперація
          | ДаніСполукиЯкщо
          | ДаніСполукиПоки
          | ДаніСполукиПеребрати
          | ДаніСполукиЦикл
          | ДаніСполукиВічнийЦикл
          | ДаніСполукиВернути
          | ДаніСполукиЗначенняЯкщо
          | ДаніСполукиСамоОперація
          | ДаніСполукиВзяти
          | ДаніСполукиСпробувати
          | ДаніСполукиВпасти
          | ДаніСполукиДати
          | ДаніСполукиМодуль
          | ДаніСполукиСписок
          | ДаніСполукиСловник
          | ДаніСполукиВизначитиЗзовні
          | ДаніСполукиВидалити
          | ДаніСполукиВидалитиВластивість
          | ДаніСполукиВидалитиЕлемент
          | ДаніСполукиЧекати
          | ДаніСполукиДіапазон
          | ДаніСполукиЗбитийТекст;
      місцезнаходження: Місцезнаходження;
    }

    // потім:
    //   - обрахунок стовпця
    //   - виправити місцезнаходження гілок

    місцева дія розібрати_на_слова(М: адреса<Машина>,
                                   значення_кд: кд,
                                   вихід: адреса<Слова>,
                                   вихід_помилки: адреса<ПомилкаРозборуНаСлова>): логічне;
    місцева дія звільнити_слова(М: адреса<Машина>,
                                слова: Слова);
    місцева дія звільнити_помилку_розбору_на_слова(М: адреса<Машина>,
                                                   помилка: ПомилкаРозборуНаСлова);
    місцева дія отримати_помилку_розбору_на_слова(М: адреса<Машина>,
                                                  помилка: ПомилкаРозборуНаСлова, вихід: адреса<кд>): логічне;
    місцева дія отримати_рядок_помилки_розбору_на_слова(М: адреса<Машина>,
                                                        помилка: ПомилкаРозборуНаСлова): природне;
    місцева дія отримати_стовпець_помилки_розбору_на_слова(М: адреса<Машина>,
                                                           помилка: ПомилкаРозборуНаСлова): природне;

    місцева дія отримати_значення_ідентифікатора(значення_кд: кд,
                                                 слова: Слова,
                                                 ідентифікатор: Ідентифікатор): кд;
    місцева дія отримати_значення_слова(значення_кд: кд,
                                        слова: Слова,
                                        слово: Слово): кд;
    місцева дія отримати_значення_тексту(значення_кд: кд,
                                         слова: Слова,
                                         слово: Слово): кд;
    місцева дія отримати_значення_символу(значення_кд: кд,
                                          слова: Слова,
                                          слово: Слово): кд;
    місцева дія отримати_рядок_з_місцезнаходження(значення_кд: кд,
                                                  слова: Слова,
                                                  місцезнаходження: Місцезнаходження): природне;
    місцева дія отримати_стовпець_з_місцезнаходження(значення_кд: кд,
                                                     слова: Слова,
                                                     місцезнаходження: Місцезнаходження): природне;

    місцева дія розібрати_слова_на_сполуки(М: адреса<Машина>,
                                           значення_кд: кд,
                                           слова: Слова,
                                           вихід: адреса<Сполуки>,
                                           вихід_помилки: адреса<ПомилкаРозборуНаСполуки>): логічне;
    місцева дія звільнити_сполуки(М: адреса<Машина>,
                                  сполуки: Сполуки);
    місцева дія звільнити_помилку_розбору_на_сполуки(М: адреса<Машина>,
                                                     помилка: ПомилкаРозборуНаСполуки);
    місцева дія отримати_помилку_розбору_на_сполуки(М: адреса<Машина>,
                                                    помилка: ПомилкаРозборуНаСполуки,
                                                    вихід: адреса<кд>): логічне;
    місцева дія отримати_рядок_помилки_розбору_на_сполуки(М: адреса<Машина>,
                                                          помилка: ПомилкаРозборуНаСполуки): природне;
    місцева дія отримати_стовпець_помилки_розбору_на_сполуки(М: адреса<Машина>,
                                                             помилка: ПомилкаРозборуНаСполуки): природне;
  }
}